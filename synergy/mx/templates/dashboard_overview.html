{% extends 'main_header.html' %}
{% block body %}

<script type="text/javascript" src="{{ url_for('static', file='js/d3-5.14.2.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', file='js/d3-scale.v2.2.2.js') }}"></script>
<script type="text/javascript" src="{{ url_for('flow/static', file='js/dagre-d3-0.6.3.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('flow/static', file='js/flow_viewer.js') }}"></script>

<link rel="stylesheet" type="text/css" href="{{ url_for('static', file='css/composite-processing-chart.css') }}">
<script type="text/javascript" src="{{ url_for('static', file='js/composite-processing-data.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', file='js/composite-processing-chart.js') }}"></script>

<div class="page-title-bar">
    {% import 'block_enable_auto_refresh.html' as block_enable_refresh %}
    {{ block_enable_refresh.enable_auto_refresh() }}
</div>

<div class="container">
    {% import 'block_time_window_selector.html' as block_time_window %}
    {{ block_time_window.time_window_selector(details, 3) }}
</div>

<script type="text/javascript">
    {#const mx_trees = {{ details.trees|jsonify|safe }};#}
    {##}
    {#// format <timeperiod: {process_name: [{job_details} ... {}], }>#}
    {#const job_matrix = {{ details.job_matrix|jsonify|safe }};#}
    {##}
    {#// format <timeperiod: {process_name: [{uow_details} ... {}], }>#}
    {#// both managed and freerun UOW are present#}
    {#const uow_matrix = {{ details.uow_matrix|jsonify|safe }};#}

    $(function () {
        {#function getJobs() {#}
        {#    const response_text = $.ajax({#}
        {#        dataType: 'json',#}
        {#        type: 'GET',#}
        {#        url: '/jobs/',#}
        {#        cache: false,#}
        {#        async: false#}
        {#    }).responseText;#}
        {#    return JSON.parse(response_text);#}
        {# } #}
        {#let jobs = getJobs();#}

        function getTrees() {
            const response_text = $.ajax({
                data: {mx_page: null},
                dataType: 'json',
                type: 'GET',
                url: '/trees/',
                cache: false,
                async: false
            }).responseText;
            return JSON.parse(response_text);
        }


        const e = document.getElementById("time_window");
        const num_days = e.options[e.selectedIndex].value;

        const jobs = {{ details.jobs|jsonify|safe }};
        const mx_trees = getTrees();
        renderCompositeProcessingChart(miserables, mx_trees, jobs, num_days);
        {#renderCompositeProcessingChart(mx_trees, job_matrix, uow_matrix);#}
    });
</script>

{% endblock %}
